#!/bin/bash

set -e

echo "ğŸ” Detecting package manager..."

if command -v dnf >/dev/null 2>&1; then
    echo "ğŸ“¦ DNF-based system detected (Fedora, RHEL, Rocky, CentOS)..."

    echo "ğŸ”„ Updating the system with DNF and installing dependencies..."
    sudo dnf check-update
    sudo dnf install -y curl unzip

    # sudo dnf fonts-powerline
    curl -s https://ohmyposh.dev/install.sh | bash -s
elif command -v apt >/dev/null 2>&1; then
    echo "ğŸ“¦ APT-based system detected (Ubuntu, Debian)..."

    echo "ğŸ”„ Updating the system with APT and installing dependencies..."
    sudo apt update
    sudo apt install -y curl unzip
    
    # Install oh-my-posh to /usr/local/bin so it's already in PATH
    sudo curl -s https://ohmyposh.dev/install.sh | sudo bash -s -- -d /usr/local/bin
else
    echo "âŒ Neither dnf nor apt found. Unsupported system."
    exit 1
fi

# Optional: Install a font for best visual experience. 'GeistMono Nerd Font Mono'
# https://www.nerdfonts.com/font-downloads
oh-my-posh font install D2Coding

cp rick.omp.json ~/rick.omp.json

if [ -f ~/rick.omp.json ]; then
    echo "âœ… File copied successfully to ~/rick.omp.json"

    {
        # echo 'export PATH=$PATH:~/.local/bin'
        echo 'eval "$(oh-my-posh init bash --config ~/rick.omp.json)"'
    } >> ~/.bashrc
else
    echo "âŒ Failed to copy the file in ~/rick.omp.json."
    exit 1
fi

echo "ğŸ”ƒ Reloading .bashrc to apply changes"
source ~/.bashrc

echo "âœ… Oh My Posh installation and configuration complete!"